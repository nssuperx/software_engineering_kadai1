<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>施設利用料金計算</title>
</head>

<body>
    <form action="#" name="form">
        <table>
            <tr>
                <th></th>
                <th>単価</th>
                <th>人数</th>
                <th>県民感謝デー<br>身分証提示人数</th>
                <th>金額</th>
            </tr>
            <tr>
                <td>大人</td>
                <td align="right" id="price1"></td>
                <td><input type="number" name="number1" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin1" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field1" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>大学生</td>
                <td align="right" id="price2"></td>
                <td><input type="number" name="number2" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin2" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field2" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>高校生・中学生</td>
                <td align="right" id="price3"></td>
                <td><input type="number" name="number3" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin3" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field3" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>小学生</td>
                <td align="right" id="price4"></td>
                <td><input type="number" name="number4" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin4" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field4" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>幼児</td>
                <td align="right" id="price5"></td>
                <td><input type="number" name="number5" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin5" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field5" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>60歳以上</td>
                <td align="right" id="price6"></td>
                <td><input type="number" name="number6" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin6" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field6" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>身障者</td>
                <td align="right" id="price7"></td>
                <td><input type="number" name="number7" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="number" name="kenmin7" onChange="calc()" min="0" step="1" value="0"></td>
                <td><input type="text" name="field7" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
            <tr>
                <td>団体（10人以上であるか）</td>
                <td align="right" colspan="2" id="group"></td>
                <td align="right" colspan="1"><strong>合計</strong></td>
                <td><input type="text" name="field_total" size="8" value="0" readonly="readonly"> 円</td>
            </tr>
        </table>
    </form>


    <script type="text/javascript">
        //価格設定
        var adult_price = 2000;
        var univ_stu_price = 1500;
        var high_stu_price = 1000;
        var elem_stu_price = 500;
        var infant_price = 0;
        var over60_price = 1000;
        var per_disability_price = 800;
        
        //割引率
        var discount_rate_kenmin = 0.2;
        var discount_rate_group = 0.1;

        //価格表示
        document.getElementById("price1").innerHTML = adult_price + "円";
        document.getElementById("price2").innerHTML = univ_stu_price + "円";
        document.getElementById("price3").innerHTML = high_stu_price + "円";
        document.getElementById("price4").innerHTML = elem_stu_price + "円";
        document.getElementById("price5").innerHTML = infant_price + "円";
        document.getElementById("price6").innerHTML = over60_price + "円";
        document.getElementById("price7").innerHTML = per_disability_price + "円";
        
        //団体割引が適用されているか表示する
        document.getElementById("group").innerHTML = "団体割引適用なし";

        //計算
        function calc() {

            //大人
            var adult_num = Math.max(parseInt(document.form.number1.value), 0);
            var adult_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin1.value), 0), adult_num);
            //少数を入力されたとき、負の数を入力されたとき、県民の数がもとの人数より多いとき対策
            var adult_normal_num = adult_num - adult_kenmin_num;
            var adult = adult_normal_num * adult_price + adult_kenmin_num * (adult_price * (1 - discount_rate_kenmin)); // 単価を設定

            //大学生
            var univ_stu_num = Math.max(parseInt(document.form.number2.value), 0);
            var univ_stu_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin2.value), 0), univ_stu_num);
            var univ_stu_normal_num = univ_stu_num - univ_stu_kenmin_num;
            var univ_stu = univ_stu_normal_num * univ_stu_price + univ_stu_kenmin_num * (univ_stu_price * (1 - discount_rate_kenmin));            

            //高校生中学生
            var high_stu_num = Math.max(parseInt(document.form.number3.value), 0);
            var high_stu_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin3.value), 0), high_stu_num);
            var high_stu_normal_num = high_stu_num - high_stu_kenmin_num;
            var high_stu = high_stu_normal_num * high_stu_price + high_stu_kenmin_num * (high_stu_price * (1 - discount_rate_kenmin));            

            //小学生
            var elem_stu_num = Math.max(parseInt(document.form.number4.value), 0);
            var elem_stu_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin4.value), 0), elem_stu_num);
            var elem_stu_normal_num = elem_stu_num - elem_stu_kenmin_num;
            var elem_stu = elem_stu_normal_num * elem_stu_price + elem_stu_kenmin_num * (elem_stu_price * (1 - discount_rate_kenmin));

            //幼児
            var infant_num = Math.max(parseInt(document.form.number5.value), 0);
            var infant_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin5.value), 0), infant_num);
            var infant_normal_num = infant_num - infant_kenmin_num;
            var infant = infant_normal_num * infant_price + infant_kenmin_num * (infant_price * (1 - discount_rate_kenmin));

            //60歳以上
            var over60_num = Math.max(parseInt(document.form.number6.value), 0);
            var over60_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin6.value), 0), over60_num);
            var over60_normal_num = over60_num - over60_kenmin_num;
            var over60 = over60_normal_num * over60_price + over60_kenmin_num * (over60_price * (1 - discount_rate_kenmin));

            //身障者
            var per_disability_num = Math.max(parseInt(document.form.number7.value), 0);
            var per_disability_kenmin_num = Math.min(Math.max(parseInt(document.form.kenmin7.value), 0), per_disability_num);
            var per_disability_normal_num = per_disability_num - per_disability_kenmin_num;
            var per_disability = per_disability_normal_num * per_disability_price + per_disability_kenmin_num * (per_disability_price * (1 - discount_rate_kenmin));

            //合計を計算
            var total = adult + univ_stu + high_stu + elem_stu + infant + over60 + per_disability;
            document.getElementById("group").innerHTML = "団体割引適用なし";

            //10人以上だったら
            if ((adult_num + univ_stu_num + high_stu_num + elem_stu_num + infant_num + over60_num + per_disability_num) >= 10) {
                total = total * (1 - discount_rate_group);
                adult = adult * (1 - discount_rate_group);
                univ_stu = univ_stu * (1 - discount_rate_group);
                high_stu = high_stu * (1 - discount_rate_group);
                elem_stu = elem_stu * (1 - discount_rate_group);
                infant = infant * (1 - discount_rate_group);
                over60 = over60 * (1 - discount_rate_group);
                per_disability = per_disability * (1 - discount_rate_group);
                document.getElementById("group").innerHTML = "団体割引適用あり";
            }
            
            //小計を表示
            document.form.field1.value = adult;
            document.form.field2.value = univ_stu;
            document.form.field3.value = high_stu;
            document.form.field4.value = elem_stu;
            document.form.field5.value = infant;
            document.form.field6.value = over60;
            document.form.field7.value = per_disability;
            
            //合計を表示
            document.form.field_total.value = total;
        }

    </script>
</body>

</html>
